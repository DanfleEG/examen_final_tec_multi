datos$estado_nutricional <- factor(datos$estado_nutricional,
levels = c("bajo_peso", "normal", "sobrepeso"))
# Convertir otras variables categóricas a factor
datos$sexo <- factor(datos$sexo)
datos$educacion_madre <- factor(datos$educacion_madre,
levels = c("primaria", "secundaria", "superior"))
datos$zona <- factor(datos$zona)
datos$dietas_solidos <- factor(datos$dietas_solidos)
# Reordenar columnas
datos <- datos[, c("id", "estado_nutricional", "edad_meses", "sexo", "peso_nacimiento",
"edad_madre", "educacion_madre", "imc_madre", "ingreso_familiar",
"zona", "lactancia_materna", "dietas_solidos")]
# Ver estructura de los datos
str(datos)
summary(datos)
head(datos)
# Tabla descriptiva por grupo nutricional
tbl_summary(datos %>% select(-id),
by = estado_nutricional,
statistic = all_continuous() ~ "{mean} ({sd})",
missing = "no") %>%
add_overall() %>%
add_p() %>%
as_kable_extra(
booktabs = TRUE,
latex_options = c("striped", "hold_position", "scale_down"))
ggplot(datos, aes(x = estado_nutricional, fill = estado_nutricional)) +
geom_bar(alpha = 0.8, width = 0.7) +
geom_text(
aes(label = paste0(round(..count../sum(..count..)*100, 1), "%")),
stat = "count",
vjust = -0.5,
size = 4,
fontface = "bold"
) +
scale_fill_manual(
values = c("bajo_peso" = "#E74C3C",    # Rojo para alerta
"normal" = "#2ECC71",       # Verde para normal
"sobrepeso" = "#F39C12"),   # Naranja para precaución
name = "Estado Nutricional"
) +
labs(
title = "Distribución del Estado Nutricional en Niños Preescolares",
subtitle = paste("N =", nrow(datos), "niños de 24-60 meses"),
x = "Categoría Nutricional",
y = "Número de Niños (Frecuencia)") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5, color = "gray40"),
axis.title = element_text(face = "bold"),
legend.position = "top",
panel.grid.major.x = element_blank()
) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) # Espacio para porcentajes
datos %>%
count(zona, estado_nutricional) %>%
group_by(zona) %>%
mutate(porcentaje = n / sum(n) * 100) %>%
ggplot(aes(x = zona, y = porcentaje, fill = estado_nutricional)) +
geom_bar(stat = "identity", position = "dodge") +
geom_text(aes(label = paste0(round(porcentaje, 1), "%")),
position = position_dodge(width = 0.9),
vjust = -0.5) +
labs(title = "Estado Nutricional por Zona de Residencia",
subtitle = "Mayor proporción de bajo peso en zona rural (p = 0.008)",
x = "Zona de Residencia",
y = "Porcentaje (%)") +
scale_fill_brewer(palette = "Set2") +
ylim(0, 100) +
theme_minimal()
library(nnet)
datos <- datos[,-1]
modelo <- nnet::multinom(estado_nutricional ~ ., data = datos)
summary(modelo)
z <- summary(modelo)$coefficients / summary(modelo)$standard.errors
p_valores <- (1 - pnorm(abs(z))) * 2
exp(coef(modelo))
modelo_nulo <- multinom(estado_nutricional ~ 1, data = datos)
anova(modelo_nulo, modelo, test = "Chisq")
install.packages("gt")
install.packages("gt")
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 5,fig.height = 4, out.width = "60%", fig.align = "center")
library(foreign)
library(MASS)
library(brant)
library(tidyverse)
library(forcats)
library(ggstatsplot)
library(emmeans)
library(gtsummary)
library(patchwork)
library(sjPlot)
library(jtools)
library(forestmodel)
library(ggeffects)
library(effectsize)
library(DHARMa)
library(cardx)
library(survey)
library(pscl)
library(rsample)
library(janitor)
library(performance)
library(tictoc)
library(caret)
library(randomForest)
library(vip)
library(stargazer)
library(gt)
library(gtsummary)
library(car)
library(nnet)
theme_set(theme_bw())
str(datos)
modelo_ordinal <- polr(estado_nutricional ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre + ingreso_familiar +
zona + lactancia_materna + dietas_solidos,
data = datos,
Hess = TRUE)  # Hess=TRUE para obtener la matriz hessiana y poder calcular los errores estándar
modelo_ordinal <- polr(estado_nutricional ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre + ingreso_familiar +
zona + lactancia_materna + dietas_solidos,
data = datos,
Hess = TRUE)  # Hess=TRUE para obtener la matriz hessiana y poder calcular los errores estándar
# Realizar la prueba de Brant
resultado_brant <- brant(modelo_ordinal)
# Mostrar los resultados
print(resultado_brant)
# Asegurarse de que la variable dependiente es un factor ordenado
datos$estado_nutricional <- factor(datos$estado_nutricional,
levels = c("bajo_peso", "normal", "sobrepeso"),
ordered = TRUE)
# Ajustar el modelo de regresión logística ordinal
modelo_ordinal <- polr(estado_nutricional ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre + ingreso_familiar +
zona + lactancia_materna + dietas_solidos,
data = datos,
Hess = TRUE)  # Hess=TRUE para obtener la matriz hessiana y poder calcular los errores estándar
resultado_brant <- brant(modelo_ordinal)
# Asegurarse de que la variable dependiente es un factor ordenado
datos$estado_nutricional <- factor(datos$estado_nutricional,
levels = c("bajo_peso", "normal", "sobrepeso"),
ordered = TRUE)
# Ajustar el modelo de regresión logística ordinal
modelo_ordinal <- polr(estado_nutricional ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre + ingreso_familiar +
zona + lactancia_materna + dietas_solidos,
data = datos,
Hess = TRUE)  # Hess=TRUE para obtener la matriz hessiana y poder calcular los errores estándar
resultado_brant <- brant(modelo_ordinal)
print(resultado_brant)
# --- PUNTO 4.1: EVALUACIÓN MODELO MULTINOMIAL VS. ORDINAL ---
# 1. Ajustar modelo ordinal (ya ordenado)
datos$estado_nutricional <- factor(datos$estado_nutricional,
levels = c("bajo_peso", "normal", "sobrepeso"),
ordered = TRUE)
modelo_ordinal <- MASS::polr(estado_nutricional ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre + ingreso_familiar +
zona + lactancia_materna + dietas_solidos,
data = datos, Hess = TRUE)
# 2. Prueba de Brant para proporcionalidad de odds
resultado_brant <- brant::brant(modelo_ordinal)
# 3. Mostrar resultados en formato de tabla profesional
cat("==============================================\n")
cat("PRUEBA DE BRANT - EVALUACIÓN DE ODDS PROPORCIONALES\n")
cat("==============================================\n")
print(resultado_brant)
# 4. Extraer estadísticos clave para el informe
p_valor_brant <- resultado_brant$p.value
# 4. Extraer estadísticos clave para el informe
p_valor_brant <- resultado_brant$p.value
chi_cuadrado <- resultado_brant$chisq
grados_libertad <- resultado_brant$df
resultado_brant$p.value
View(modelo_ordinal)
print(resultado_brant)
modelo_ordinal
# 2. Prueba de Brant para proporcionalidad de odds
resultado_brant <- brant::brant(modelo_ordinal)
datos$estado_nutricional <- factor(datos$estado_nutricional,
levels = c("bajo_peso", "normal", "sobrepeso"),
ordered = TRUE)
modelo_ordinal <- MASS::polr(estado_nutricional ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre + ingreso_familiar +
zona + lactancia_materna + dietas_solidos,
data = datos, Hess = TRUE)
modelo_ordinal
# 2. Prueba de Brant para proporcionalidad de odds
resultado_brant <- brant::brant(modelo_ordinal)
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 5,fig.height = 4, out.width = "60%", fig.align = "center")
library(foreign)
library(MASS)
library(brant)
library(tidyverse)
library(forcats)
library(ggstatsplot)
library(emmeans)
library(gtsummary)
library(patchwork)
library(sjPlot)
library(jtools)
library(forestmodel)
library(ggeffects)
library(effectsize)
library(DHARMa)
library(cardx)
library(survey)
library(pscl)
library(rsample)
library(janitor)
library(performance)
library(tictoc)
library(caret)
library(randomForest)
library(vip)
library(stargazer)
library(gt)
library(gtsummary)
library(car)
library(nnet)
theme_set(theme_bw())
# Método CORRECTO para calcular VIF con modelo multinomial:
# 1. Crear un modelo lineal auxiliar
modelo_lineal_auxiliar <- lm(ingreso_familiar ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre +
zona + lactancia_materna + dietas_solidos,
data = datos)
# 2. Calcular VIF sobre el modelo lineal
library(car)
vif_resultados <- vif(modelo_lineal_auxiliar)
vif_resultados
# Código completo y correcto para tu trabajo:
cat("\n=== 4.2. AUSENCIA DE MULTICOLINEALIDAD (VIF) ===\n")
# Ajustar modelo lineal auxiliar para cálculo de VIF
# (La multicolinealidad se evalúa entre predictores, independientemente del tipo de modelo)
modelo_aux_vif <- lm(ingreso_familiar ~ .,
data = datos[, !names(datos) %in% c("estado_nutricional")])
# Calcular VIF
vif_vals <- car::vif(modelo_aux_vif)
# Crear tabla de resultados
tabla_vif <- data.frame(
Predictor = names(vif_vals),
VIF = round(vif_vals, 2),
Interpretación = case_when(
vif_vals < 5 ~ "Aceptable",
vif_vals < 10 ~ "Moderado",
TRUE ~ "Problemático"
)
)
# Crear tabla de resultados
tabla_vif <- data.frame(
Predictor = names(vif_vals),
VIF = round(vif_vals, 2),
Interpretación = case_when(
vif_vals < 5 ~ "Aceptable",
vif_vals < 10 ~ "Moderado",
TRUE ~ "Problemático"
)
)
print(tabla_vif, row.names = FALSE)
# Crear un modelo lineal con todas las variables predictoras
modelo_lineal_vif <- lm(ingreso_familiar ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre +
zona + lactancia_materna + dietas_solidos,
data = datos)
# Calcular VIF usando la función vif() del paquete car
library(car)
vif_resultados <- vif(modelo_lineal_vif)
# Mostrar resultados en formato de tabla
cat("\n\n=== 4.2. AUSENCIA DE MULTICOLINEALIDAD (VIF) ===\n")
cat("==================================================\n\n")
# Crear una tabla con los resultados
tabla_vif <- data.frame(
Variable = names(vif_resultados),
VIF = round(vif_resultados, 3),
Interpretación = ifelse(vif_resultados < 5, "Sin multicolinealidad",
ifelse(vif_resultados < 10, "Multicolinealidad moderada",
"Multicolinealidad alta"))
)
vif_resultados
ggplot(data.frame(Variable = names(vif_resultados), VIF = vif_resultados),
aes(x = reorder(Variable, VIF), y = VIF)) +
geom_bar(stat = "identity", fill = ifelse(vif_resultados < 5, "steelblue",
ifelse(vif_resultados < 10, "orange", "red"))) +
geom_hline(yintercept = 5, linetype = "dashed", color = "orange", linewidth = 0.8) +
geom_hline(yintercept = 10, linetype = "dashed", color = "red", linewidth = 0.8) +
coord_flip() +
labs(title = "Factores de Inflación de la Varianza (VIF)",
subtitle = "Límites recomendados: <5 (azul), 5-10 (naranja), ≥10 (rojo)",
x = "Variable predictora",
y = "Valor VIF") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
print(vif_resultados)
# Matriz de correlación entre variables continuas
variables_continuas <- datos[, c("edad_meses", "peso_nacimiento", "edad_madre",
"imc_madre", "ingreso_familiar", "lactancia_materna")]
matriz_correlacion <- cor(variables_continuas, use = "complete.obs")
cat("Correlaciones más altas (>|0.5|):\n")
cor_altas <- which(abs(matriz_correlacion) > 0.5 & upper.tri(matriz_correlacion), arr.ind = TRUE)
if(length(cor_altas) > 0) {
for(i in 1:nrow(cor_altas)) {
var1 <- rownames(matriz_correlacion)[cor_altas[i, 1]]
var2 <- colnames(matriz_correlacion)[cor_altas[i, 2]]
correlacion <- matriz_correlacion[cor_altas[i, 1], cor_altas[i, 2]]
cat(sprintf("  %s - %s: r = %.3f\n", var1, var2, correlacion))
}
} else {
cat("  No hay correlaciones > |0.5| entre variables continuas.\n")
}
# Conclusión final
cat("\n\nCONCLUSIÓN PARA EL INFORME:\n")
cat("----------------------------------------\n")
cat("Basado en los valores VIF calculados, se puede afirmar que:\n")
if(all(vif_resultados < 5)) {
cat("El modelo no presenta problemas de multicolinealidad.\n")
cat("Todas las variables predictoras aportan información independiente.\n")
cat("Las estimaciones de los coeficientes son estables y confiables.\n")
} else {
cat("Se detectaron algunos niveles de multicolinealidad que podrían afectar\n")
cat("la estabilidad de las estimaciones. Sin embargo, dado que ningún VIF\n")
cat("supera el umbral crítico de 10, el modelo puede considerarse aceptable.\n")
}
cor_altas
if(length(cor_altas) > 0) {
for(i in 1:nrow(cor_altas)) {
var1 <- rownames(matriz_correlacion)[cor_altas[i, 1]]
var2 <- colnames(matriz_correlacion)[cor_altas[i, 2]]
correlacion <- matriz_correlacion[cor_altas[i, 1], cor_altas[i, 2]]
cat(sprintf("  %s - %s: r = %.3f\n", var1, var2, correlacion))
}
} else {
cat("  No hay correlaciones > |0.5| entre variables continuas.\n")
}
# Método alternativo 2: VIF específico para modelos multinomiales
# Nota: No hay función VIF nativa para multinom, pero podemos calcular manualmente
cat("\n\n--- ANÁLISIS DE CORRELACIONES ENTRE VARIABLES CONTINUAS ---\n")
# Matriz de correlación entre variables continuas
variables_continuas <- datos[, c("edad_meses", "peso_nacimiento", "edad_madre",
"imc_madre", "ingreso_familiar", "lactancia_materna")]
matriz_correlacion <- cor(variables_continuas, use = "complete.obs")
cor_altas <- which(abs(matriz_correlacion) > 0.5 & upper.tri(matriz_correlacion), arr.ind = TRUE)
if(length(cor_altas) > 0) {
for(i in 1:nrow(cor_altas)) {
var1 <- rownames(matriz_correlacion)[cor_altas[i, 1]]
var2 <- colnames(matriz_correlacion)[cor_altas[i, 2]]
correlacion <- matriz_correlacion[cor_altas[i, 1], cor_altas[i, 2]]
cat(sprintf("  %s - %s: r = %.3f\n", var1, var2, correlacion))
}
} else {
cat("  No hay correlaciones > |0.5| entre variables continuas.\n")
}
if(all(vif_resultados < 5)) {
cat("El modelo no presenta problemas de multicolinealidad.\n")
cat("Todas las variables predictoras aportan información independiente.\n")
cat("Las estimaciones de los coeficientes son estables y confiables.\n")
} else {
cat("Se detectaron algunos niveles de multicolinealidad que podrían afectar\n")
cat("la estabilidad de las estimaciones. Sin embargo, dado que ningún VIF\n")
cat("supera el umbral crítico de 10, el modelo puede considerarse aceptable.\n")
}
# Gráfico opcional de VIF (visualización)
if(require(ggplot2)) {
ggplot(data.frame(Variable = names(vif_resultados), VIF = vif_resultados),
aes(x = reorder(Variable, VIF), y = VIF)) +
geom_bar(stat = "identity", fill = ifelse(vif_resultados < 5, "steelblue",
ifelse(vif_resultados < 10, "orange", "red"))) +
geom_hline(yintercept = 5, linetype = "dashed", color = "orange", linewidth = 0.8) +
geom_hline(yintercept = 10, linetype = "dashed", color = "red", linewidth = 0.8) +
coord_flip() +
labs(title = "Factores de Inflación de la Varianza (VIF)",
subtitle = "Límites recomendados: <5 (azul), 5-10 (naranja), ≥10 (rojo)",
x = "Variable predictora",
y = "Valor VIF") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
}
# Gráfico opcional de VIF (visualización)
ggplot(data.frame(Variable = names(vif_resultados), VIF = vif_resultados),
aes(x = reorder(Variable, VIF), y = VIF)) +
geom_bar(stat = "identity", fill = ifelse(vif_resultados < 5, "steelblue",
ifelse(vif_resultados < 10, "orange", "red"))) +
geom_hline(yintercept = 5, linetype = "dashed", color = "orange", linewidth = 0.8) +
geom_hline(yintercept = 10, linetype = "dashed", color = "red", linewidth = 0.8) +
coord_flip() +
labs(title = "Factores de Inflación de la Varianza (VIF)",
subtitle = "Límites recomendados: <5 (azul), 5-10 (naranja), ≥10 (rojo)",
x = "Variable predictora",
y = "Valor VIF") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
View(vif_resultados)
vif_resultados <- car::vif(modelo_lineal_auxiliar)
vif_resultados
# Gráfico opcional de VIF (visualización)
ggplot(data.frame(Variable = names(vif_resultados), VIF = vif_resultados),
aes(x = reorder(Variable, VIF), y = VIF)) +
geom_bar(stat = "identity", fill = ifelse(vif_resultados < 5, "steelblue",
ifelse(vif_resultados < 10, "orange", "red"))) +
geom_hline(yintercept = 5, linetype = "dashed", color = "orange", linewidth = 0.8) +
geom_hline(yintercept = 10, linetype = "dashed", color = "red", linewidth = 0.8) +
coord_flip() +
labs(title = "Factores de Inflación de la Varianza (VIF)",
subtitle = "Límites recomendados: <5 (azul), 5-10 (naranja), ≥10 (rojo)",
x = "Variable predictora",
y = "Valor VIF") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
vif_resultados <- car::vif(modelo_lineal_auxiliar)
vif_resultados
View(vif_resultados)
# Gráfico opcional de VIF (visualización)
ggplot(data.frame(Variable = names(vif_resultados), VIF = vif_resultados),
aes(x = reorder(Variable, VIF), y = VIF)) +
geom_bar(stat = "identity", fill = ifelse(vif_resultados < 5, "steelblue",
ifelse(vif_resultados < 10, "orange", "red"))) +
geom_hline(yintercept = 5, linetype = "dashed", color = "orange", linewidth = 0.8) +
geom_hline(yintercept = 10, linetype = "dashed", color = "red", linewidth = 0.8) +
coord_flip() +
labs(title = "Factores de Inflación de la Varianza (VIF)",
subtitle = "Límites recomendados: <5 (azul), 5-10 (naranja), ≥10 (rojo)",
x = "Variable predictora",
y = "Valor VIF") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5))
# Gráfico opcional de VIF (visualización)
df_vif <- data.frame(
Variable = names(vif_resultados),
VIF = as.numeric(vif_resultados),
row.names = NULL
)
# Gráfico opcional de VIF (visualización)
df_vif <- data.frame(
Variable = names(vif_resultados),
VIF = as.numeric(vif_resultados),
row.names = NULL
)
vif_resultados
# Gráficos de residuales parciales (para anexos)
par(mfrow = c(2, 3))
variables_continuas <- c("edad_meses", "peso_nacimiento", "edad_madre",
"imc_madre", "ingreso_familiar", "lactancia_materna")
for(var in variables_continuas) {
# Modelo lineal generalizado simplificado (binario) para visualización
datos$y_bin <- as.numeric(datos$estado_nutricional == "normal")
modelo_bin <- glm(y_bin ~ get(var), data = datos, family = binomial)
# Gráfico de residuales parciales
termplot(modelo_bin, partial.resid = TRUE, smooth = loess,
main = paste("Residuales parciales:", var),
xlab = var, ylab = "Logit parcial")
}
par(mfrow = c(2, 3))
variables_continuas <- c("edad_meses", "peso_nacimiento", "edad_madre",
"imc_madre", "ingreso_familiar")
datos$y_bin <- as.numeric(datos$estado_nutricional == "normal")
for (var in variables_continuas) {
# Crear la fórmula correctamente
f <- as.formula(paste("y_bin ~", var))
modelo_bin <- glm(f, data = datos, family = binomial)
termplot(modelo_bin,
partial.resid = TRUE,
smooth = loess,
main = paste("Residuales parciales:", var),
xlab = var,
ylab = "Logit parcial")
}
str(datos[, variables_continuas])
par(mfrow = c(2, 3))
variables_continuas <- c("edad_meses", "peso_nacimiento", "edad_madre",
"imc_madre", "Ingreso_familiar")
# Asegurar que el nombre coincide EXACTO
names(datos)[names(datos) == "ingreso_familiar"] <- "Ingreso_familiar"
datos$y_bin <- as.numeric(datos$estado_nutricional == "normal")
for (var in variables_continuas) {
# Construir fórmula válida
f <- reformulate(var, "y_bin")
modelo_bin <- glm(f, data = datos, family = binomial)
termplot(modelo_bin,
partial.resid = TRUE,
se = TRUE,
smooth = loess,
main = paste("Residuales parciales:", var),
xlab = var,
ylab = "Logit parcial")
}
binomial
datos
glm
par(mfrow = c(2, 3))
variables_continuas <- c("edad_meses", "peso_nacimiento", "edad_madre",
"imc_madre", "Ingreso_familiar")
# Asegurar que el nombre coincide EXACTO
names(datos)[names(datos) == "ingreso_familiar"] <- "Ingreso_familiar"
datos$y_bin <- as.numeric(datos$estado_nutricional == "normal")
for (var in variables_continuas) {
# Construir fórmula válida
f <- reformulate(var, "y_bin")
modelo_bin <- glm(f, data = datos, family = binomial)
termplot(modelo_bin,
partial.resid = TRUE,
se = TRUE,
smooth = loess,
main = paste("Residuales parciales:", var),
xlab = var,
ylab = "Logit parcial")
}
