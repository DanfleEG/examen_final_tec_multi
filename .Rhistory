knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 5,fig.height = 4, out.width = "60%", fig.align = "center")
library(foreign)
library(MASS)
library(brant)
library(tidyverse)
library(forcats)
library(ggstatsplot)
library(emmeans)
library(gtsummary)
library(patchwork)
library(sjPlot)
library(jtools)
library(forestmodel)
library(ggeffects)
library(effectsize)
library(DHARMa)
library(cardx)
library(survey)
library(pscl)
library(rsample)
library(janitor)
library(performance)
library(tictoc)
library(caret)
library(randomForest)
library(vip)
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 5,fig.height = 4, out.width = "60%", fig.align = "center")
library(foreign)
library(MASS)
library(brant)
library(tidyverse)
library(forcats)
library(ggstatsplot)
library(emmeans)
library(gtsummary)
library(patchwork)
library(sjPlot)
library(jtools)
library(forestmodel)
library(ggeffects)
library(effectsize)
library(DHARMa)
library(cardx)
library(survey)
library(pscl)
library(rsample)
library(janitor)
library(performance)
library(tictoc)
library(caret)
library(randomForest)
library(vip)
install.packages("vip")
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 5,fig.height = 4, out.width = "60%", fig.align = "center")
library(foreign)
library(MASS)
library(brant)
library(tidyverse)
library(forcats)
library(ggstatsplot)
library(emmeans)
library(gtsummary)
library(patchwork)
library(sjPlot)
library(jtools)
library(forestmodel)
library(ggeffects)
library(effectsize)
library(DHARMa)
library(cardx)
library(survey)
library(pscl)
library(rsample)
library(janitor)
library(performance)
library(tictoc)
library(caret)
library(randomForest)
library(vip)
install.packages("vip")
library(vip)
version
chooseCRANmirror()
install.packages("vip")
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 5,fig.height = 4, out.width = "60%", fig.align = "center")
library(foreign)
library(MASS)
library(brant)
library(tidyverse)
library(forcats)
library(ggstatsplot)
library(emmeans)
library(gtsummary)
library(patchwork)
library(sjPlot)
library(jtools)
library(forestmodel)
library(ggeffects)
library(effectsize)
library(DHARMa)
library(cardx)
library(survey)
library(pscl)
library(rsample)
library(janitor)
library(performance)
library(tictoc)
library(caret)
library(randomForest)
library(vip)
chooseCRANmirror()
install.packages("vip")
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 5,fig.height = 4, out.width = "60%", fig.align = "center")
library(foreign)
library(MASS)
library(brant)
library(tidyverse)
library(forcats)
library(ggstatsplot)
library(emmeans)
library(gtsummary)
library(patchwork)
library(sjPlot)
library(jtools)
library(forestmodel)
library(ggeffects)
library(effectsize)
library(DHARMa)
library(cardx)
library(survey)
library(pscl)
library(rsample)
library(janitor)
library(performance)
library(tictoc)
library(caret)
library(randomForest)
library(vip)
install.packages("vip", repos = "https://cloud.r-project.org")
install.packages("vip", repos = "https://cran.rstudio.com")
getOption("repos")
install.packages("remotes")
remotes::install_github("koalaverse/vip")
install.packages("vip")
remotes::install_github("koalaverse/vip")
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 5,fig.height = 4, out.width = "60%", fig.align = "center")
library(foreign)
library(MASS)
library(brant)
library(tidyverse)
library(forcats)
library(ggstatsplot)
library(emmeans)
library(gtsummary)
library(patchwork)
library(sjPlot)
library(jtools)
library(forestmodel)
library(ggeffects)
library(effectsize)
library(DHARMa)
library(cardx)
library(survey)
library(pscl)
library(rsample)
library(janitor)
library(performance)
library(tictoc)
library(caret)
library(randomForest)
library(vip)
library(stargazer)
theme_set(theme_bw())
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 5,fig.height = 4, out.width = "60%", fig.align = "center")
library(foreign)
library(MASS)
library(brant)
library(tidyverse)
library(forcats)
library(ggstatsplot)
library(emmeans)
library(gtsummary)
library(patchwork)
library(sjPlot)
library(jtools)
library(forestmodel)
library(ggeffects)
library(effectsize)
library(DHARMa)
library(cardx)
library(survey)
library(pscl)
library(rsample)
library(janitor)
library(performance)
library(tictoc)
library(caret)
library(randomForest)
library(vip)
library(stargazer)
theme_set(theme_bw())
# Set seed para reproducibilidad
set.seed(123)
# Número de observaciones
n <- 500
# Simulación de variables
datos <- data.frame(
# ID del niño
id = 1:n,
# Variables del niño
edad_meses = round(runif(n, 24, 60)),
sexo = sample(c("femenino", "masculino"), n, replace = TRUE, prob = c(0.48, 0.52)),
peso_nacimiento = round(runif(n, 2.0, 4.5), 1),
# Variables maternas
edad_madre = round(runif(n, 18, 45)),
educacion_madre = sample(c("primaria", "secundaria", "superior"), n,
replace = TRUE, prob = c(0.4, 0.45, 0.15)),
imc_madre = round(runif(n, 18, 35), 1),
# Variables socioeconómicas
ingreso_familiar = round(runif(n, 200, 1200)),
zona = sample(c("urbana", "rural"), n, replace = TRUE, prob = c(0.6, 0.4)),
# Variables de alimentación
lactancia_materna = round(runif(n, 0, 24)),
dietas_solidos = sample(c("si", "no"), n, replace = TRUE, prob = c(0.3, 0.7))
)
# Simular la variable dependiente con relaciones lógicas
# Crear puntajes latentes para cada categoría
prob_bajo <- with(datos,
plogis(-1.5 + 0.02*(edad_meses) - 0.3*(peso_nacimiento - 3.2) +
0.05*(edad_madre - 30) - 0.001*ingreso_familiar +
ifelse(zona == "rural", 0.5, 0)))
prob_sobre <- with(datos,
plogis(-2.0 + 0.01*(edad_meses) + 0.2*(peso_nacimiento - 3.2) +
0.02*(imc_madre - 25) - 0.01*lactancia_materna +
ifelse(educacion_madre == "superior", -0.5,
ifelse(educacion_madre == "secundaria", -0.2, 0))))
# Asignar categorías
datos$estado_nutricional <- sapply(1:n, function(i) {
probs <- c(prob_bajo[i], 1 - prob_bajo[i] - prob_sobre[i], prob_sobre[i])
# Asegurar probabilidades válidas
probs <- pmax(pmin(probs, 0.9), 0.05)
probs <- probs / sum(probs)
sample(c("bajo_peso", "normal", "sobrepeso"), 1, prob = probs)
})
# Convertir a factor con orden lógico
datos$estado_nutricional <- factor(datos$estado_nutricional,
levels = c("bajo_peso", "normal", "sobrepeso"))
# Convertir otras variables categóricas a factor
datos$sexo <- factor(datos$sexo)
datos$educacion_madre <- factor(datos$educacion_madre,
levels = c("primaria", "secundaria", "superior"))
datos$zona <- factor(datos$zona)
datos$dietas_solidos <- factor(datos$dietas_solidos)
# Reordenar columnas
datos <- datos[, c("id", "estado_nutricional", "edad_meses", "sexo", "peso_nacimiento",
"edad_madre", "educacion_madre", "imc_madre", "ingreso_familiar",
"zona", "lactancia_materna", "dietas_solidos")]
# Ver estructura de los datos
str(datos)
summary(datos)
head(datos)
# Tabla descriptiva por grupo nutricional
tbl_summary(datos %>% select(-id),
by = estado_nutricional,
statistic = all_continuous() ~ "{mean} ({sd})",
missing = "no") %>%
add_overall() %>%
add_p() %>%
as_kable_extra(
booktabs = TRUE,
latex_options = c("striped", "hold_position", "scale_down"))
ggplot(datos, aes(x = estado_nutricional, fill = estado_nutricional)) +
geom_bar(alpha = 0.8, width = 0.7) +
geom_text(
aes(label = paste0(round(..count../sum(..count..)*100, 1), "%")),
stat = "count",
vjust = -0.5,
size = 4,
fontface = "bold"
) +
scale_fill_manual(
values = c("bajo_peso" = "#E74C3C",    # Rojo para alerta
"normal" = "#2ECC71",       # Verde para normal
"sobrepeso" = "#F39C12"),   # Naranja para precaución
name = "Estado Nutricional"
) +
labs(
title = "Distribución del Estado Nutricional en Niños Preescolares",
subtitle = paste("N =", nrow(datos), "niños de 24-60 meses"),
x = "Categoría Nutricional",
y = "Número de Niños (Frecuencia)") +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5, color = "gray40"),
axis.title = element_text(face = "bold"),
legend.position = "top",
panel.grid.major.x = element_blank()
) +
scale_y_continuous(expand = expansion(mult = c(0, 0.1))) # Espacio para porcentajes
datos %>%
count(zona, estado_nutricional) %>%
group_by(zona) %>%
mutate(porcentaje = n / sum(n) * 100) %>%
ggplot(aes(x = zona, y = porcentaje, fill = estado_nutricional)) +
geom_bar(stat = "identity", position = "dodge") +
geom_text(aes(label = paste0(round(porcentaje, 1), "%")),
position = position_dodge(width = 0.9),
vjust = -0.5) +
labs(title = "Estado Nutricional por Zona de Residencia",
subtitle = "Mayor proporción de bajo peso en zona rural (p = 0.008)",
x = "Zona de Residencia",
y = "Porcentaje (%)") +
scale_fill_brewer(palette = "Set2") +
ylim(0, 100) +
theme_minimal()
library(nnet)
datos <- datos[,-1]
modelo <- nnet::multinom(estado_nutricional ~ ., data = datos)
summary(modelo)
z <- summary(modelo)$coefficients / summary(modelo)$standard.errors
p_valores <- (1 - pnorm(abs(z))) * 2
exp(coef(modelo))
modelo_nulo <- multinom(estado_nutricional ~ 1, data = datos)
anova(modelo_nulo, modelo, test = "Chisq")
install.packages("gt")
install.packages("gt")
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 5,fig.height = 4, out.width = "60%", fig.align = "center")
library(foreign)
library(MASS)
library(brant)
library(tidyverse)
library(forcats)
library(ggstatsplot)
library(emmeans)
library(gtsummary)
library(patchwork)
library(sjPlot)
library(jtools)
library(forestmodel)
library(ggeffects)
library(effectsize)
library(DHARMa)
library(cardx)
library(survey)
library(pscl)
library(rsample)
library(janitor)
library(performance)
library(tictoc)
library(caret)
library(randomForest)
library(vip)
library(stargazer)
library(gt)
library(gtsummary)
library(car)
library(nnet)
theme_set(theme_bw())
str(datos)
modelo_ordinal <- polr(estado_nutricional ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre + ingreso_familiar +
zona + lactancia_materna + dietas_solidos,
data = datos,
Hess = TRUE)  # Hess=TRUE para obtener la matriz hessiana y poder calcular los errores estándar
modelo_ordinal <- polr(estado_nutricional ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre + ingreso_familiar +
zona + lactancia_materna + dietas_solidos,
data = datos,
Hess = TRUE)  # Hess=TRUE para obtener la matriz hessiana y poder calcular los errores estándar
# Realizar la prueba de Brant
resultado_brant <- brant(modelo_ordinal)
# Mostrar los resultados
print(resultado_brant)
# Asegurarse de que la variable dependiente es un factor ordenado
datos$estado_nutricional <- factor(datos$estado_nutricional,
levels = c("bajo_peso", "normal", "sobrepeso"),
ordered = TRUE)
# Ajustar el modelo de regresión logística ordinal
modelo_ordinal <- polr(estado_nutricional ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre + ingreso_familiar +
zona + lactancia_materna + dietas_solidos,
data = datos,
Hess = TRUE)  # Hess=TRUE para obtener la matriz hessiana y poder calcular los errores estándar
resultado_brant <- brant(modelo_ordinal)
# Asegurarse de que la variable dependiente es un factor ordenado
datos$estado_nutricional <- factor(datos$estado_nutricional,
levels = c("bajo_peso", "normal", "sobrepeso"),
ordered = TRUE)
# Ajustar el modelo de regresión logística ordinal
modelo_ordinal <- polr(estado_nutricional ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre + ingreso_familiar +
zona + lactancia_materna + dietas_solidos,
data = datos,
Hess = TRUE)  # Hess=TRUE para obtener la matriz hessiana y poder calcular los errores estándar
resultado_brant <- brant(modelo_ordinal)
print(resultado_brant)
# --- PUNTO 4.1: EVALUACIÓN MODELO MULTINOMIAL VS. ORDINAL ---
# 1. Ajustar modelo ordinal (ya ordenado)
datos$estado_nutricional <- factor(datos$estado_nutricional,
levels = c("bajo_peso", "normal", "sobrepeso"),
ordered = TRUE)
modelo_ordinal <- MASS::polr(estado_nutricional ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre + ingreso_familiar +
zona + lactancia_materna + dietas_solidos,
data = datos, Hess = TRUE)
# 2. Prueba de Brant para proporcionalidad de odds
resultado_brant <- brant::brant(modelo_ordinal)
# 3. Mostrar resultados en formato de tabla profesional
cat("==============================================\n")
cat("PRUEBA DE BRANT - EVALUACIÓN DE ODDS PROPORCIONALES\n")
cat("==============================================\n")
print(resultado_brant)
# 4. Extraer estadísticos clave para el informe
p_valor_brant <- resultado_brant$p.value
# 4. Extraer estadísticos clave para el informe
p_valor_brant <- resultado_brant$p.value
chi_cuadrado <- resultado_brant$chisq
grados_libertad <- resultado_brant$df
resultado_brant$p.value
View(modelo_ordinal)
print(resultado_brant)
modelo_ordinal
# 2. Prueba de Brant para proporcionalidad de odds
resultado_brant <- brant::brant(modelo_ordinal)
datos$estado_nutricional <- factor(datos$estado_nutricional,
levels = c("bajo_peso", "normal", "sobrepeso"),
ordered = TRUE)
modelo_ordinal <- MASS::polr(estado_nutricional ~ edad_meses + sexo + peso_nacimiento +
edad_madre + educacion_madre + imc_madre + ingreso_familiar +
zona + lactancia_materna + dietas_solidos,
data = datos, Hess = TRUE)
modelo_ordinal
# 2. Prueba de Brant para proporcionalidad de odds
resultado_brant <- brant::brant(modelo_ordinal)
